import { decodeEventLog } from 'viem';
import { CLANKER_ABI } from '@wiretap/config';
import type { TokenCreatedLog } from './types/token-created.js';
import { onLog } from './on-logs.js';
import { Span } from '@wiretap/utils/shared';

const log_delegated = {
  address: '0x2a787b2362021cc3eea3c24c4748a6cd5b687382',
  blockHash:
    '0xde6dcb8ac77003fa131b6ab0d2bf6fedec77e2e9913d03c7388803c2f1b9ac50',
  blockNumber: '0x1bf5568',
  data: '0x000000000000000000000000d6603bad319f66ec58013d35c0c198a39ce8acd40000000000000000000000001eaf444ebdf6495c57ad52a04c61521bbf564ace00000000000000000000000000000000000000000000000000000000002c924d000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000001a0fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc222800000000000000000000000000000000000000000000000000000000000001e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d6603bad319f66ec58013d35c0c198a39ce8acd400000000000000000000000000000000000000000000000000000000000000085768656e204f6e65000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000657454e4f4e450000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004d7b226465736372697074696f6e223a224e6f206465736372697074696f6e2070726f7669646564222c22736f6369616c4d6564696155726c73223a5b5d2c22617564697455726c73223a5b5d7d00000000000000000000000000000000000000',
  logIndex: '0x107',
  removed: false,
  topics: [
    '0x6b04d68ca5c822b9c981d731c83ecb1356b96c8596c7659d397d234856a4537b',
    '0x000000000000000000000000c1f4c76e8c5d39da0910c69f8428b710dbbacb07',
    '0x000000000000000000000000d6603bad319f66ec58013d35c0c198a39ce8acd4',
    '0x000000000000000000000000eea96d959963eab488a3d4b7d5d347785cf1eab8'
  ],
  transactionHash:
    '0x463475eec3241c6e44dca80141d2f97eac2abee44368b851d2fbb3f4aec21a3a',
  transactionIndex: '0x47'
};

const decoded = decodeEventLog({
  abi: CLANKER_ABI,
  eventName: 'TokenCreated',
  data: log_delegated.data as `0x${string}`,
  topics: log_delegated.topics as [
    signature: `0x${string}`,
    ...args: `0x${string}`[]
  ],
  strict: true
}) as TokenCreatedLog;
decoded.transactionHash = log_delegated.transactionHash as `0x${string}`;
decoded.address = log_delegated.address as `0x${string}`;
decoded.blockNumber = BigInt(log_delegated.blockNumber);
const span = new Span(decoded.address);
await onLog(decoded, { tracing: { parentSpan: span } });
span.finish('ok');
// console.log(JSON.stringify(span, null, 2));
// console.log(parseEther('0.0001', 'wei'));
// console.log(computeBaseAssetRation(20n, 1000n));
// console.log(computeBaseAssetRation(1000n, 1000n));
// console.log(computeBaseAssetRation(1000n, 200n));